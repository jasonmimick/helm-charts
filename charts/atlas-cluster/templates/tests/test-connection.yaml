apiVersion: v1
kind: Pod
metadata:
  name: {{ include "atlas-cluster.fullname" . }}-test-connection
  labels:
    {{- include "atlas-cluster.labels" . | nindent 4 }}
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: mongodb-connection-tester 
      image: jmimick/mongodb-connection-tester
      env:
      - name: MONGODB_URI
        valueFrom:
          secretKeyRef:
            name: {{ .Values.project.atlasProjectName }}-{{ include "atlas-cluster.fullname" $ }}-{{ (index .Values.users 0).username }}
            key: connectionString.standard
      - name: MONGODB_URI_SRV
        valueFrom:
          secretKeyRef:
            name: {{ .Values.project.atlasProjectName }}-{{ include "atlas-cluster.fullname" $ }}-{{ (index .Values.users 0).username }}
            key: connectionString.standardSrv
      - name: MONGODB_USERNAME
        valueFrom:
          secretKeyRef:
            name: {{ .Values.project.atlasProjectName }}-{{ include "atlas-cluster.fullname" $ }}-{{ (index .Values.users 0).username }}
            key: username
      - name: MONGODB_PASSWORD
        valueFrom:
          secretKeyRef:
            name: {{ .Values.project.atlasProjectName }}-{{ include "atlas-cluster.fullname" $ }}-{{ (index .Values.users 0).username }}
            key: password
  restartPolicy: Never
